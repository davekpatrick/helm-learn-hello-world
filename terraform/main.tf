#######################################################################################################################
## ----------------------------------------------------------------------------------------------------------------- ##
## Terraform Root Module
## ------------------------------
## - 
## ----------------------------------------------------------------------------------------------------------------- ##
#######################################################################################################################
# BOF
terraform {
  # Terraform version required for this module to function
  required_version = "~> 1.4"
  # ---------------------------------------------------
  # Setup providers
  # ---------------------------------------------------
  required_providers {
    #
    google = {
      source  = "registry.terraform.io/hashicorp/google"
      version = "~> 4.69"
    }
    #
    google-beta = {
      source  = "registry.terraform.io/hashicorp/google-beta"
      version = "~> 4.69"
    }
  } #END => required_providers
  # ---------------------------------------------------
  # Setup Backend
  # ---------------------------------------------------
  # Managed through Terraform Cloud Version Control Integration
  # url: https://app.terraform.io/app/davekpatrick/workspaces/my-gcp-sandbox-inception
  # ---------------------------------------------------
} #END => terraform
## ---------------------------------------------------
## provider setup and authorization
## ---------------------------------------------------
provider "google" {
  # assign the project to execute within
  project = var.gcpProject
  # setup location
  region = var.gcpRegion
  zone   = var.gcpZone
}
provider "google-beta" {
  # assign the project to execute within
  project = var.gcpProject
  # setup location
  region = var.gcpRegion
  zone   = var.gcpZone
}
#######################################################################################################################
## ----------------------------------------------------------------------------------------------------------------- ##
## Local variable setup
## ----------------------------------------------------------------------------------------------------------------- ##
#######################################################################################################################
#
locals {
  # 
  resourcePrefix = "helm-learn"
  #
  helloWordName = "hello-world"
  helloWordIpVersion = "IPV4"
  helloWordDnsRecordType = "A"
}
#######################################################################################################################
## ----------------------------------------------------------------------------------------------------------------- ##
## Data
## ----------------------------------------------------------------------------------------------------------------- ##
#######################################################################################################################
#
## ---------------------------------------------------
data "google_project" "project" {
}
data "google_dns_managed_zone" "default" {
  name = var.dnsZoneName
}
#######################################################################################################################
## ----------------------------------------------------------------------------------------------------------------- ##
## Resources
## ----------------------------------------------------------------------------------------------------------------- ##
#######################################################################################################################
#
## ---------------------------------------------------
resource "google_compute_global_address" "helloWorld" {
  project      = var.gcpProject 
  name         = format( "%s-%s", local.resourcePrefix, local.helloWordName)
  address_type = "EXTERNAL"
  ip_version   = local.helloWordIpVersion
}
resource "google_dns_record_set" "helloWorld" {
  name         = format( "%s.%s", local.helloWordName, data.google_dns_managed_zone.default.dns_name )
  managed_zone = data.google_dns_managed_zone.default.name
  type         = local.helloWordDnsRecordType
  ttl          = 300
  rrdatas = [resource.google_compute_global_address.helloWorld.address]
}
## ---------------------------------------------------

#######################################################################################################################
## ----------------------------------------------------------------------------------------------------------------- ##
## Modules
## ----------------------------------------------------------------------------------------------------------------- ##
#######################################################################################################################
# None
#######################################################################################################################
## ----------------------------------------------------------------------------------------------------------------- ##
#######################################################################################################################
# EOF